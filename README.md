# 跳跳星 (JumpStar)

> **版本**: v2.1.0 | **狀態**: ✅ 可用於實際測試

## 專案簡介

跳跳星是一個基於 Arduino UNO 的互動式跳躍遊戲裝置，使用**超音波感測器 HC-SR04** 偵測玩家跳躍，並使用 **4 條 WS2813 LED 燈條**提供即時視覺回饋。遊戲採用**七彩分層跳躍計數模式**，玩家需完成 7 個顏色階段的挑戰，每個階段需跳躍指定次數才能進入下一階段。完成所有階段後會進入**彩虹霓虹慶祝模式**，鼓勵玩家持續運動。超過閒置時間則會直接重置計數。

## 硬體需求

-   **主控板**: Arduino UNO (ATmega328P)
-   **感測器**: 超音波感測器 HC-SR04（偵測距離閾值：50cm）
-   **LED 燈條**: WS2813 LED 燈條 × 4 條（每條 37 顆，共 148 顆，支援備援訊號 BI）
-   **電源供應**: 5V 10A 以上電源供應器（4 條燈條最大約 8.88A，實際使用約 4-5A）
-   **接線**:
    -   超音波 Trig → Arduino Pin 3
    -   超音波 Echo → Arduino Pin 4
    -   LED 燈條 1 DI → Arduino Pin 5
    -   LED 燈條 2 DI → Arduino Pin 6
    -   LED 燈條 3 DI → Arduino Pin 9
    -   LED 燈條 4 DI → Arduino Pin 10
    -   所有 LED BI → 空接（測試可正常運作）
    -   Arduino GND + 電源 GND → 共地（必須！）

## 功能特色

-   🔵 **超音波感測器**：可調整偵測距離閾值（預設 50cm），精確捕捉跳躍動作
-   ⚡ **即時跳躍偵測**：精確捕捉離地和著地時刻，含訊號去彈跳處理
-   � **七彩分層模式**：7 個顏色階段（紅 → 橙 → 黃 → 綠 → 青 → 藍 → 紫），每階段需完成指定跳躍次數
-   � **漸變燈效**：使用 HSV 色彩空間，顏色平滑過渡，視覺效果更豐富
-   🎉 **彩虹霓虹模式**：完成所有階段後進入流動彩虹慶祝動畫
-   📺 **4 條燈條同步**：4 條燈條同步顯示相同內容（可切換獨立控制模式）
-   📊 **智慧比例分配**：每個階段自動適應燈條長度（每條 37 顆）
-   ⏰ **閒置自動重置**：5 秒無跳躍自動清空 LED 並重置計數
-   � **靈活調整**：可配置每次跳躍點亮的 LED 數量（預設 3 顆）
-   🔧 **參數可調**：偵測距離、跳躍次數、逾時時間、LED 數量、顏色等
-   🧪 **LED 診斷測試**：開機可執行完整的 LED 測試動畫（逐顆掃描、三原色測試）

## 工作原理

### 🎮 遊戲模式：七彩分層跳躍挑戰

1. **超音波偵測**：感測器持續監測玩家位置（距離 < 50cm = 在地面）
2. **狀態判定**：
    - 距離 < 50cm → LOW（玩家在地面）
    - 距離 ≥ 50cm → HIGH（玩家離地/跳躍中）
3. **跳躍計數**：每次狀態改變（LOW ↔ HIGH）計數 +1（適合小朋友的小碎步）
4. **七彩階段**：
    - 共 7 個顏色階段：紅 → 橙 → 黃 → 綠 → 青 → 藍 → 紫
    - 每個階段需跳躍指定次數（預設：每 3 次跳躍點亮燈條至滿燈）
    - 完成一個階段後，新顏色從底部開始填充，逐漸覆蓋舊顏色
5. **即時回饋**：
    - 4 條 LED 燈條同步顯示相同內容
    - 每次跳躍點亮 3 顆 LED（可調整）
    - 當前階段進度清晰可見
6. **彩虹慶祝**：完成所有 7 個階段後，進入流動彩虹霓虹模式
7. **自動重置**：5 秒無跳躍後自動清空計數，重新開始

### 🎯 設計理念

-   **七彩分層系統**：每個顏色代表一個挑戰階段，視覺層次豐富
-   **階段式挑戰**：逐步完成各階段，增加遊戲趣味性和成就感
-   **彩虹慶祝模式**：完成所有階段的獎勵，鼓勵玩家達成目標
-   **靈活配置**：可調整每次跳躍點亮數量（`LEDS_PER_JUMP`）
-   **自動適應**：根據燈條長度自動計算每階段所需跳躍次數
-   **4 條同步顯示**：增加視覺衝擊力，提升遊戲體驗
-   **符合體能標準**：參考國小學生體適能資料設定難度
-   **色彩心理學**：使用 HSV 色彩空間，色相間距加大以增加辨識度

## 開發環境

-   PlatformIO
-   Arduino Framework

## 專案狀態

✅ **核心功能完成** - 基礎跳躍偵測與 LED 回饋系統已實作並可運作

## 已完成功能

### v2.1.0（當前版本）

-   [x] 🌈 **七彩分層系統**：7 個顏色階段（紅 → 橙 → 黃 → 綠 → 青 → 藍 → 紫），階段式挑戰
-   [x] 🎉 **彩虹霓虹模式**：完成所有階段後的流動彩虹慶祝動畫
-   [x] � **4 條燈條同步**：4 條燈條同步顯示（Pin 5, 6, 9, 10），支援獨立控制模式
-   [x] 🎨 **新顏色定義**：優化色相間距，增加顏色辨識度和視覺差異性
-   [x] 🎯 **靈活點亮配置**：可調整每次跳躍點亮數量（預設 3 顆）
-   [x] 📊 **自動階段計算**：根據燈條長度和點亮數量自動計算階段需求
-   [x] 🔧 **同步/獨立模式**：支援燈條同步顯示或獨立控制（`SYNC_MODE`）

### v2.0.0

-   [x] �🔵 **超音波感測器整合**：使用 HC-SR04，可調整偵測距離閾值（50cm）
-   [x] 🎮 **連續跳躍計數系統**：累積跳躍次數，精確的狀態機實作
-   [x] ⏰ **閒置自動重置**：5 秒無跳躍直接清空計數
-   [x] 🎯 **體能標準設定**：參考國小學生體適能資料調整難度
-   [x] 📈 **即時進度顯示**：持續顯示累積成果，含距離資訊
-   [x] 🌈 **HSV 漸變燈效**：使用 HSV 色彩空間實現平滑過渡
-   [x] 🧪 **LED 診斷測試**：開機可執行測試動畫（逐顆掃描、三原色）
-   [x] 🎨 **WS2813 支援**：適配 RGB 色序與備援訊號配置
-   [x] 🔧 **可配置參數**：LED 數量、偵測距離、跳躍次數、逾時時間等

### v1.2.0

-   [x] 🎯 **雙感測器支援**：紅外線 + 超音波可切換（目前版本主要使用超音波）
-   [x] 🌈 **動態漸變燈效**：每顆 LED 獨立色彩，HSV 平滑過渡
-   [x] 🔧 **超音波距離偵測**：可調整閾值（v2.0.0 更新為 50cm）
-   [x] 📡 **即時監控輸出**：顯示感測器狀態與距離值
-   [x] 🧪 **LED 測試診斷**：完整的硬體測試流程

### v1.1.0

-   [x] 紅外線感測器初始化與校準（v2.0.0 改用超音波為主）
-   [x] 跳躍偵測邏輯實作（含訊號去彈跳）
-   [x] 計時器功能開發（使用 `millis()` 非阻塞式計時）
-   [x] WS2813 燈條控制（FastLED 3.10.3 函式庫）
-   [x] LED 開機測試動畫（6 階段診斷測試）

## 硬體配置說明

### LED 燈條接線（4 條 WS2813）

#### 每條 WS2813 燈條的接線（輸入端）：

-   **DI (Data Input)** → Arduino Pin（5/6/9/10）（主要資料輸入）
-   **BI (Backup Input)** → 空接（本專案測試可正常運作）
-   **GND** → Arduino GND + 電源 GND（**必須共地！**）
-   **5V** → 外部電源 5V（**不要用 Arduino 供電！**）

#### 4 條燈條接線方式：

```
燈條 1: Arduino Pin 5  -------- DI
燈條 2: Arduino Pin 6  -------- DI
燈條 3: Arduino Pin 9  -------- DI
燈條 4: Arduino Pin 10 -------- DI
所有 BI ----------------------- 空接（不連接）
Arduino GND ------------------ GND（所有燈條共地）
外部電源 5V ------------------ 5V（所有燈條）
外部電源 GND ----------------- GND（與 Arduino GND 共地）
```

#### WS2813 雙訊號說明

-   BI 是備援訊號輸入，當 DI 損壞時可自動切換到 BI
-   本專案測試結果：BI 空接也能正常工作
-   如需使用備援功能：將 BI 連接到 GND 或與 DI 並聯

#### 電源注意事項（4 條燈條）

-   **總 LED 數量**：4 條 × 37 顆 = 148 顆
-   **最大電流**：148 × 60mA = 8.88A
-   **實際使用**（50% 亮度）：約 4-5A
-   **電源選擇**：建議使用 5V 10A 以上電源供應器
-   **電源注入**：大量 LED 建議每 50-100 顆注入一次電源，避免壓降

### 可配置參數

在 `src/main.cpp` 中可調整以下參數：

```cpp
// 超音波感測器
const int TRIG_PIN = 3;                    // Trig 腳位
const int ECHO_PIN = 4;                    // Echo 腳位
const int DETECTION_DISTANCE = 50;         // 偵測距離閾值（cm）

// LED 燈條（4 條）
const int NUM_LED_STRIPS = 4;              // LED 燈條數量
const int LED_PINS[4] = {5, 6, 9, 10};    // LED 資料腳位
const int NUM_LEDS = 37;                   // 每條燈條的 LED 數量
const int LED_BRIGHTNESS = 50;             // 亮度（0-255，建議不超過 50%）
const bool SYNC_MODE = true;               // 同步模式（true=同步，false=獨立）

// 七彩階段參數
const int NUM_COLOR_STAGES = 7;            // 七彩階段數量
const int LEDS_PER_JUMP = 3;               // 每次跳躍點亮的 LED 數量
const int JUMPS_PER_STAGE = (NUM_LEDS + LEDS_PER_JUMP - 1) / LEDS_PER_JUMP;  // 每階段跳躍次數（自動計算）
const int MAX_JUMP_COUNT = JUMPS_PER_STAGE * NUM_COLOR_STAGES;  // 總跳躍次數（自動計算）

// 七彩顏色定義（HSV 色相值）
const uint8_t RAINBOW_COLORS[7] = {
    0,    // 紅色
    28,   // 橙色
    64,   // 黃色
    96,   // 綠色
    140,  // 青色
    170,  // 藍色
    200   // 紫紅色
};

// 彩虹霓虹燈效參數
const unsigned long RAINBOW_UPDATE_INTERVAL = 30;  // 更新間隔（ms）
const uint8_t RAINBOW_HUE_STEP = 2;                // 色相變化量

// 其他參數
const unsigned long IDLE_TIMEOUT = 5000;   // 閒置逾時（ms）
const unsigned long DEBOUNCE_DELAY = 25;   // 去彈跳時間（ms）
```

## 待開發功能

### 遊戲模式擴充

-   [ ] 紅外線感測器整合與快速切換機制
-   [ ] 獨立控制模式實作（4 條燈條顯示不同內容）
-   [ ] 多種遊戲模式（計時挑戰、限時模式、雙人 PK 模式）
-   [ ] 難度等級選擇（不同跳躍次數要求、顏色階段數）
-   [ ] 最高紀錄保存與顯示（EEPROM）

### 互動與回饋

-   [ ] 外部按鈕控制（模式切換、重置、難度選擇）
-   [ ] 音效輸出（蜂鳴器或 MP3 模組，配合階段完成）
-   [ ] 階段完成慶祝動畫（每完成一個階段的小動畫）
-   [ ] 更多 LED 效果（星星閃爍、呼吸燈、流星效果）

### 進階功能

-   [ ] 無線連接（藍牙/WiFi 數據上傳）
-   [ ] 手機 App 連動（記錄統計、排行榜）
-   [ ] 多人協作模式（多個感測器同時運作）
-   [ ] 實際硬體長時間測試與參數微調
-   [ ] 閃爍警告機制（可選擇性恢復）

## 📚 文件導覽

### 新手入門

-   **[快速入門指南](QUICK_START.md)** - 🚀 5 分鐘快速上手
-   **[硬體安裝指南](HARDWARE_SETUP.md)** - 🔧 詳細的硬體連接與測試步驟
-   **[測試指南](TESTING_GUIDE.md)** - 🧪 完整的測試步驟與驗證

### 進階資料

-   **[程式碼說明文件](CODE_DOCUMENTATION.md)** - 💻 深入了解程式架構與客製化
-   **[變更日誌](CHANGELOG.md)** - 📝 版本更新記錄
-   **[專案總結](PROJECT_SUMMARY.md)** - 📊 完整的專案開發總結與統計
-   **[配置範例](examples/config_examples.cpp)** - 🎨 各種配置與擴充範例

### 開發者資訊

-   **[AI 編碼指引](.github/copilot-instructions.md)** - 🤖 AI 協作開發規範
-   **[開發計畫](.github/prompts/plan.prompt.md)** - 📋 專案開發計畫

## 檔案結構

```
JumpStar/
├── src/
│   └── main.cpp                      # 主程式（v2.0.0，超音波感測器）
├── include/                          # 標頭檔案
├── lib/                              # 專案相關函式庫
├── test/                             # 測試程式
├── examples/
│   └── config_examples.cpp           # 配置範例
├── .github/
│   ├── copilot-instructions.md       # AI 編碼指引
│   └── prompts/
│       └── plan.prompt.md            # 開發計畫
├── platformio.ini                    # PlatformIO 設定檔（FastLED 3.10.3）
├── README.md                         # 本文件
├── QUICK_START.md                    # 快速入門
├── HARDWARE_SETUP.md                 # 硬體指南
├── CODE_DOCUMENTATION.md             # 程式碼文件
├── TESTING_GUIDE.md                  # 測試指南
├── CHANGELOG.md                      # 變更日誌
└── LICENSE                           # MIT License
```

## 授權

本專案採用 [MIT License](LICENSE)。

## 作者

待補充
