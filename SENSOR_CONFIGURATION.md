# 感測器配置指南

## 🎯 概述

跳跳星系統支援兩種感測器模式，可透過簡單的配置切換：

-   **🔴 紅外線感測器**：適合短距離偵測（約 8cm）
-   **🔵 超音波感測器**：適合中距離偵測（可設定 10-100cm）

---

## 🔧 硬體接線

### 紅外線感測器模式

```
紅外線感測器 → Arduino UNO
├─ VCC → 5V
├─ GND → GND
└─ OUT → D2
```

### 超音波感測器模式

```
超音波感測器 (HC-SR04) → Arduino UNO
├─ VCC  → 5V
├─ GND  → GND
├─ Trig → D3
└─ Echo → D4
```

**注意**：兩種感測器可同時接線，系統會根據配置選擇使用哪一種。

---

## ⚙️ 軟體配置

### 切換感測器模式

打開 `src/main.cpp`，找到檔案開頭的配置區：

```cpp
// ========== 感測器選擇 ==========
// 設定為 true 使用超音波，設定為 false 使用紅外線
#define USE_ULTRASONIC true
```

#### 使用超音波感測器（推薦）

```cpp
#define USE_ULTRASONIC true
```

#### 使用紅外線感測器

```cpp
#define USE_ULTRASONIC false
```

### 調整超音波偵測距離

```cpp
// ========== 超音波感測器設定 ==========
const int TRIG_PIN = 3;                 // Trig 腳位
const int ECHO_PIN = 4;                 // Echo 腳位
const int DETECTION_DISTANCE = 30;      // 偵測距離閾值（公分）
```

**參數說明**：

-   `DETECTION_DISTANCE`：當物體距離 **小於此值** 時判定為「有人在地面」
-   建議範圍：`10` ~ `100` cm
-   預設值：`30` cm（適合跳躍偵測）

---

## 📊 感測器比較

| 特性         | 紅外線感測器 | 超音波感測器       |
| ------------ | ------------ | ------------------ |
| **偵測距離** | 3-8 cm       | 2-400 cm（可調整） |
| **反應速度** | 極快         | 快                 |
| **穩定性**   | 高           | 中（受環境影響）   |
| **成本**     | 低           | 中                 |
| **安裝難度** | 簡單         | 簡單               |
| **適用場景** | 接觸式偵測   | 非接觸式偵測       |
| **環境影響** | 光線干擾     | 溫度、障礙物       |

---

## 🚀 使用建議

### 紅外線感測器適合：

✅ 需要精確觸發點的場景  
✅ 固定距離偵測  
✅ 對距離要求嚴格的應用  
✅ 預算有限的情況

❌ 不適合：偵測範圍需要較大的場景

### 超音波感測器適合：

✅ 需要較大偵測範圍（推薦）  
✅ 非接觸式偵測  
✅ 可調整靈敏度的場景  
✅ 跳躍高度較高的玩家

❌ 不適合：需要極高精度的場景

---

## 🔍 序列埠監控輸出

### 紅外線模式

```
=== 跳跳星系統啟動 ===
✅ 使用紅外線感測器模式
[感測器] 數位訊號: LOW (有人在地面)
[感測器] 數位訊號: HIGH (無人/跳躍中)
```

### 超音波模式

```
=== 跳跳星系統啟動 ===
✅ 使用超音波感測器模式
✅ 偵測距離閾值: 30 cm
[感測器] 數位訊號: LOW (有人在地面) | 距離: 12 cm
[感測器] 數位訊號: HIGH (無人/跳躍中) | 距離: 85 cm
```

**超音波模式額外資訊**：

-   顯示即時距離值（cm）
-   可用於調整 `DETECTION_DISTANCE` 參數

---

## 🛠️ 調校步驟

### 超音波感測器調校

1. **上傳程式並開啟監控**

    ```bash
    pio run --target upload
    pio device monitor
    ```

2. **觀察距離讀值**

    - 站在感測器上方，觀察「有人在地面」時的距離值
    - 跳起後，觀察「無人/跳躍中」時的距離值

3. **調整閾值**

    - 假設腳在地面時距離為 `15 cm`
    - 跳起後距離為 `60 cm`
    - 建議設定閾值為中間值：`DETECTION_DISTANCE = 30`

4. **驗證**
    - 確認站立時顯示 `LOW (有人在地面)`
    - 確認跳起時顯示 `HIGH (無人/跳躍中)`

### 紅外線感測器調校

1. **調整電位器**

    - 感測器上通常有一個可調電位器
    - 順時針旋轉增加靈敏度
    - 逆時針旋轉降低靈敏度

2. **測試距離**
    - 將手慢慢靠近感測器
    - 觀察序列埠輸出何時從 HIGH 變為 LOW
    - 調整至約 5-8 cm 觸發為最佳

---

## 🔧 故障排除

### 超音波感測器問題

#### 問題：距離讀值一直顯示 999

**可能原因**：

-   Echo 或 Trig 接線錯誤
-   感測器損壞
-   超出最大偵測範圍（>4m）

**解決方法**：

1. 檢查接線：Trig→D3, Echo→D4
2. 確認供電正常（VCC 接 5V）
3. 測試時在感測器 2 米內

#### 問題：距離值不穩定，跳動很大

**可能原因**：

-   偵測表面不平整
-   環境中有反射物
-   感測器角度不正確

**解決方法**：

1. 確保感測器垂直向上
2. 移除附近反射物（金屬、光滑表面）
3. 增加去彈跳時間：`DEBOUNCE_DELAY = 100`

#### 問題：跳躍時無法觸發

**可能原因**：

-   `DETECTION_DISTANCE` 設定太大
-   感測器安裝位置不佳

**解決方法**：

1. 降低閾值，例如改為 `20` cm
2. 確認感測器正對玩家腳底

### 紅外線感測器問題

#### 問題：無法偵測到腳

**解決方法**：

-   調整感測器電位器增加靈敏度
-   確認感測器朝上對準腳底
-   檢查 D2 接線是否正確

#### 問題：一直顯示 LOW 或 HIGH 不變

**解決方法**：

-   檢查 VCC 和 GND 接線
-   測試感測器是否損壞
-   確認 Arduino D2 腳位正常

---

## 📝 配置範例

### 範例 1：室內跳躍遊戲（推薦超音波）

```cpp
#define USE_ULTRASONIC true
const int DETECTION_DISTANCE = 30;  // 30cm 閾值
```

### 範例 2：精確觸發板（推薦紅外線）

```cpp
#define USE_ULTRASONIC false
// 紅外線模式，約 5-8cm 觸發
```

### 範例 3：兒童使用（較大範圍）

```cpp
#define USE_ULTRASONIC true
const int DETECTION_DISTANCE = 40;  // 40cm 閾值
```

### 範例 4：專業運動員（較小範圍）

```cpp
#define USE_ULTRASONIC true
const int DETECTION_DISTANCE = 20;  // 20cm 閾值
```

---

## 🎓 技術細節

### 感測器邏輯統一

為了讓兩種感測器無縫切換，系統將它們的輸出統一為數位訊號邏輯：

-   **LOW (0)** = 有人在感應範圍內（在地面）
-   **HIGH (1)** = 無人在範圍內（跳躍中）

### 超音波轉數位訊號

```cpp
if (distance < DETECTION_DISTANCE) {
    return LOW;   // 有人在地面
} else {
    return HIGH;  // 無人/跳躍中
}
```

### 去彈跳機制

兩種感測器都使用相同的去彈跳邏輯（50ms），確保訊號穩定。

---

## 📞 需要協助？

如果遇到問題：

1. **檢查硬體**：確認接線正確、供電正常
2. **序列埠監控**：觀察感測器輸出是否正常
3. **調整參數**：根據實際測試調整閾值
4. **切換模式**：嘗試另一種感測器

---

**配置指南版本：v1.2.0**  
_最後更新：2025-10-07_
